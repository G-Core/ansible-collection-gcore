---
- vars:
    api_token: "{{ GCORE_API_TOKEN }}"
    api_host: "{{ GCORE_API_HOST }}"
    project_id: "{{ GCORE_PROJECT_ID }}"
    region_id: "{{ GCORE_REGION_ID }}"
    volume_source: "new-volume"
    volume_name: "test_ansible_volume"

  block:
    - name: Create new volume for snapshot
      gcore.cloud.volume:
        api_token: "{{ api_token }}"
        api_host: "{{ api_host }}"
        project_id: "{{ project_id }}"
        region_id: "{{ region_id }}"
        command: create
        source: "{{ volume_source }}"
        name: "{{ volume_name }}"
        size: 1
      register: create_result

    - name: Verify create task
      ansible.builtin.assert:
        that:
          - create_result.data["tasks"] | list | length == 1
    
    - name: Wait for volume
      ansible.builtin.pause:
        minutes: 1
